<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>æ¬¢è¿ - ResearchHelper</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <link rel="stylesheet" href="scrollbar.css" />

    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      html,
      body {
        height: 100%;
        font-family: "Segoe UI", sans-serif;
        transition: background-color 0.3s, color 0.3s;
      }

      body.light-mode {
        background: #f9fafc;
        color: #000;
      }
      body.dark-mode {
        background: #1e1e1e;
        color: #eee;
      }

      .container {
        display: flex;
        height: 100vh;
      }

      /* â”€â”€ ä¾§è¾¹æ  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      .sidebar {
        width: 72px;
        background: #000;
        padding: 20px 0;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: center;
        -webkit-app-region: drag;
      }

      .logo {
        cursor: default; /* Logo åªæ˜¯è£…é¥°ï¼Œä¸æ˜¯æŒ‰é’® */
        -webkit-app-region: drag; /* ä¿ç•™æ‹–çª—åŠŸèƒ½ */
        display: flex;
        justify-content: center;
        align-items: center;
        width: 40px;
        height: 40px;
        margin-bottom: 20px;
        font-size: 24px;
        color: #fff;
        text-decoration: none;
        border-radius: 8px;
        transition: background 0.2s, transform 0.2s, color 0.2s;
      }
      .nav-links a,
      .footer {
        /* æŠŠ footer ä¹Ÿå½“æŒ‰é’®å¤„ç† */
        display: flex;
        justify-content: center;
        align-items: center;
        width: 40px;
        height: 40px;
        margin-bottom: 20px;
        font-size: 24px;
        color: #fff;
        text-decoration: none;
        border-radius: 8px;
        transition: background 0.2s, transform 0.2s, color 0.2s;
        cursor: pointer;
        -webkit-app-region: no-drag; /* è®©æŒ‰é’®å¯ç‚¹å‡» */
      }

      .logo:hover,
      .nav-links a:hover,
      .footer:hover {
        background: #a2c9ef;
        transform: translateY(-2px);
      }

      .nav-links a.active {
        background: #5da3fa;
        color: #000;
      }
      body.dark-mode .nav-links a.active {
        background: #2e7ae5;
        color: #fff;
      }

      /* â”€â”€ ä¸»åŒºåŸŸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      .main {
        flex: 1;
      }
      iframe {
        width: 100%;
        height: 100%;
        border: none;
        display: block;
        background: #1e1e1e; /* match = dark */
      }
      body.light-mode iframe {
        background: #f9fafc; /* match = light */
      }
      /* ä¾§è¾¹æ åº•éƒ¨æŒ‰é’®ç»„ */
      .bottom-links {
        display: flex;
        flex-direction: column; /* çºµå‘å¹¶æ’ */
        align-items: center;
        gap: 14px; /* ä¿©å›¾æ ‡ä¹‹é—´ç•™å°ç©ºéš™ */
        position: relative;
      }

      /* åˆ†éš”çº¿ï¼ˆå¯æŒ‰éœ€åˆ æ”¹ï¼‰ */
      .bottom-links::before {
        content: "";
        position: absolute;
        top: -22px; /* è·ç¦»æŒ‰é’®ç»„ä¸Šæ–¹ 22px */
        width: 32px;
        height: 1px;
        background: rgba(255, 255, 255, 0.12); /* æ·±è‰²æ¨¡å¼çš„æ·¡çº¿ */
        border-radius: 9999px;
      }
      body.light-mode .bottom-links::before {
        background: rgba(0, 0, 0, 0.12); /* æµ…è‰²æ¨¡å¼ */
      }
      .sidebar .footer {
        margin: 0 !important;
      }
      .pin-btn {
        background: transparent !important; /* è¦†ç›– nav-links çš„é»˜è®¤èƒŒæ™¯ */
      }

      .pin-btn i {
        color: #fff;
        transition: color 0.25s ease, transform 0.25s ease;
      }

      /* æ¿€æ´»ï¼šé’‰å­æœ¬èº«å˜ Accent é¢œè‰²ï¼Œå¹¶è½»è½»æ—‹è½¬ */
      .pin-btn.pin-active i {
        color: var(--accent, #3d7dff);
        transform: rotate(45deg);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- ä¾§è¾¹æ  -->
      <!-- ä¾§è¾¹æ  -->
      <div class="sidebar">
        <!-- â‘  é¡¶éƒ¨ Logo -->
        <div class="logo" title="ResearchHelper">ğŸ“Ÿ</div>

        <!-- â‘¡ ä¸»å¯¼èˆª -->
        <div class="nav-links">
          <a data-src="./hotsearch.html" title="çƒ­æœ"
            ><i class="fa-solid fa-fire"></i
          ></a>
          <a data-src="settings.html" title="è®¾ç½®"
            ><i class="fa-solid fa-gear"></i
          ></a>
          <a id="btnPin" class="pin-btn" title="çª—å£ç½®é¡¶">
            <i class="fa-solid fa-thumbtack"></i>
          </a>
        </div>

        <!-- â‘¢ åº•éƒ¨â€œäºŒäººç»„â€ â­ï¸â­ï¸â­ï¸ -->
        <div class="bottom-links">
          <!-- æ–°å¢ -->
          <a class="footer" data-src="about.html" title="å…³äº">
            <i class="fa-solid fa-user-astronaut"></i>
          </a>
          <a id="btnExit" class="footer" title="é€€å‡º">
            <i class="fa-solid fa-right-from-bracket"></i>
          </a>
        </div>
      </div>

      <!-- å³ä¾§ iframe -->
      <div class="main">
        <iframe id="mainFrame" name="mainFrame" src="./hotsearch.html"></iframe>
      </div>
    </div>

    <script>
      /* ä¸»é¢˜åˆå§‹åŒ– */
      document.body.classList.add(
        (localStorage.getItem("theme") || "light") + "-mode"
      );

      document.addEventListener("DOMContentLoaded", () => {
        const iframe = document.getElementById("mainFrame");
        const navLinks = document.querySelectorAll(".nav-links a[data-src]");
        const footer = document.querySelector(".footer[data-src]");

        /** é«˜äº®å¤„ç† */
        function setActive(link) {
          navLinks.forEach((l) => l.classList.toggle("active", l === link));
        }

        /* ä¾§è¾¹æ æ™®é€šæŒ‰é’® */
        navLinks.forEach((link) => {
          link.addEventListener("click", (e) => {
            e.preventDefault();
            iframe.src = link.dataset.src;
            setActive(link);
          });
        });

        /* é»˜è®¤é«˜äº®ç¬¬ä¸€ä¸ªï¼ˆçƒ­æœï¼‰ */
        setActive(
          document.querySelector('.nav-links a[data-src="./hotsearch.html"]')
        );

        /* footer -> about.htmlï¼ˆä¸å‚ä¸é«˜äº®ï¼‰ */
        footer.addEventListener("click", (e) => {
          e.preventDefault();
          iframe.src = footer.dataset.src;
          setActive(null); // å–æ¶ˆä¾§æ é«˜äº®
        });
      });
      // åœ¨ä¾§æ  JS é‡Œ
      const prefetch = (url) => fetch(url).then((r) => r.blob());

      // åˆå§‹åŒ–æ—¶ï¼š
      ["hotsearch.html", "settings.html", "about.html"].forEach(prefetch);

      /* â€”â€” åŒæ­¥çˆ¶é¡µé¢ä¸»é¢˜ â€”â€” */
      (function () {
        const applyTheme = (theme = "light") => {
          document.body.classList.remove("light-mode", "dark-mode");
          document.body.classList.add(theme + "-mode");

          /* åŒæ­¥ iframe çš„çº¯è‰²åº•è‰²ï¼Œé˜²æ­¢ä¸‹ä¸€æ¬¡å¸è½½æ—¶å‡ºç°åè‰²é—ªçƒ */
          const frame = document.getElementById("mainFrame");
          if (frame)
            frame.style.background = theme === "dark" ? "#1e1e1e" : "#f9fafc";
        };

        /* é¦–æ¬¡è¿›æ¥å°±æŒ‰ localStorage ç»˜åˆ¶ */
        applyTheme(localStorage.getItem("theme"));

        /* ç›‘å¬å…¶å®ƒé¡µé¢ï¼ˆiframeï¼‰æ”¹åŠ¨ localStorage æ—¶è§¦å‘çš„ storage äº‹ä»¶ */
        window.addEventListener("storage", (e) => {
          if (e.key === "theme") applyTheme(e.newValue || "light");
        });
      })();
      const btnExit = document.getElementById("btnExit");

      btnExit.addEventListener("click", (e) => {
        e.preventDefault();
        // å¯é€‰ï¼šäºŒæ¬¡ç¡®è®¤
        // if (confirm("ç¡®è®¤é€€å‡º ResearchHelperï¼Ÿ")) {
        ipcRenderer.send("app-exit"); // å‘ç»™ä¸»è¿›ç¨‹
        // }
      });
      const btnPin = document.getElementById("btnPin");

      /* è¯·æ±‚ä¸»è¿›ç¨‹åˆ‡æ¢ç½®é¡¶ï¼›æ”¶åˆ°çŠ¶æ€åå†æ”¹å›¾æ ‡ */
      btnPin.addEventListener("click", (e) => {
        e.preventDefault();
        window.electronAPI.toggleTop();
      });

      /* ä¸»è¿›ç¨‹è¿”å›ç½®é¡¶çŠ¶æ€æ—¶åˆ‡æ¢æ ·å¼ */
      window.electronAPI.onTopState((isTop) => {
        btnPin.classList.toggle("pin-active", isTop); // â† åªæ”¹è¿™é‡Œ
      });

      const applyTheme = (t) => {
        document.documentElement.classList.remove("light-mode", "dark-mode");
        document.body.classList.remove("light-mode", "dark-mode");
        document.documentElement.classList.add(`${t}-mode`);
        document.body.classList.add(`${t}-mode`);
      };
      applyTheme(localStorage.getItem("theme") || "light");
      window.addEventListener("storage", (e) => {
        if (e.key === "theme") applyTheme(e.newValue || "light");
      });
    </script>
  </body>
</html>
