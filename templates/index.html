<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>欢迎 - ResearchHelper</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <link rel="stylesheet" href="scrollbar.css" />

    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      html,
      body {
        height: 100%;
        font-family: "Segoe UI", sans-serif;
        transition: background-color 0.3s, color 0.3s;
      }

      body.light-mode {
        background: #f9fafc;
        color: #000;
      }
      body.dark-mode {
        background: #1e1e1e;
        color: #eee;
      }

      .container {
        display: flex;
        height: 100vh;
      }

      /* ── 侧边栏 ─────────────────────────────── */
      .sidebar {
        width: 72px;
        background: #000;
        padding: 20px 0;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: center;
        -webkit-app-region: drag;
      }

      .logo {
        cursor: default; /* Logo 只是装饰，不是按钮 */
        -webkit-app-region: drag; /* 保留拖窗功能 */
        display: flex;
        justify-content: center;
        align-items: center;
        width: 40px;
        height: 40px;
        margin-bottom: 20px;
        font-size: 24px;
        color: #fff;
        text-decoration: none;
        border-radius: 8px;
        transition: background 0.2s, transform 0.2s, color 0.2s;
      }
      .nav-links a,
      .footer {
        /* 把 footer 也当按钮处理 */
        display: flex;
        justify-content: center;
        align-items: center;
        width: 40px;
        height: 40px;
        margin-bottom: 20px;
        font-size: 24px;
        color: #fff;
        text-decoration: none;
        border-radius: 8px;
        transition: background 0.2s, transform 0.2s, color 0.2s;
        cursor: pointer;
        -webkit-app-region: no-drag; /* 让按钮可点击 */
      }

      .logo:hover,
      .nav-links a:hover,
      .footer:hover {
        background: #a2c9ef;
        transform: translateY(-2px);
      }

      .nav-links a.active {
        background: #5da3fa;
        color: #000;
      }
      body.dark-mode .nav-links a.active {
        background: #2e7ae5;
        color: #fff;
      }

      /* ── 主区域 ─────────────────────────────── */
      .main {
        flex: 1;
      }
      iframe {
        width: 100%;
        height: 100%;
        border: none;
        display: block;
        background: #1e1e1e; /* match = dark */
      }
      body.light-mode iframe {
        background: #f9fafc; /* match = light */
      }
      /* 侧边栏底部按钮组 */
      .bottom-links {
        display: flex;
        flex-direction: column; /* 纵向并排 */
        align-items: center;
        gap: 14px; /* 俩图标之间留小空隙 */
        position: relative;
      }

      /* 分隔线（可按需删改） */
      .bottom-links::before {
        content: "";
        position: absolute;
        top: -22px; /* 距离按钮组上方 22px */
        width: 32px;
        height: 1px;
        background: rgba(255, 255, 255, 0.12); /* 深色模式的淡线 */
        border-radius: 9999px;
      }
      body.light-mode .bottom-links::before {
        background: rgba(0, 0, 0, 0.12); /* 浅色模式 */
      }
      .sidebar .footer {
        margin: 0 !important;
      }
      .pin-btn {
        background: transparent !important; /* 覆盖 nav-links 的默认背景 */
      }

      .pin-btn i {
        color: #fff;
        transition: color 0.25s ease, transform 0.25s ease;
      }

      /* 激活：钉子本身变 Accent 颜色，并轻轻旋转 */
      .pin-btn.pin-active i {
        color: var(--accent, #3d7dff);
        transform: rotate(45deg);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- 侧边栏 -->
      <!-- 侧边栏 -->
      <div class="sidebar">
        <!-- ① 顶部 Logo -->
        <div class="logo" title="ResearchHelper">📟</div>

        <!-- ② 主导航 -->
        <div class="nav-links">
          <a data-src="./hotsearch.html" title="热搜"
            ><i class="fa-solid fa-fire"></i
          ></a>
          <a data-src="settings.html" title="设置"
            ><i class="fa-solid fa-gear"></i
          ></a>
          <a id="btnPin" class="pin-btn" title="窗口置顶">
            <i class="fa-solid fa-thumbtack"></i>
          </a>
        </div>

        <!-- ③ 底部“二人组” ⭐️⭐️⭐️ -->
        <div class="bottom-links">
          <!-- 新增 -->
          <a class="footer" data-src="about.html" title="关于">
            <i class="fa-solid fa-user-astronaut"></i>
          </a>
          <a id="btnExit" class="footer" title="退出">
            <i class="fa-solid fa-right-from-bracket"></i>
          </a>
        </div>
      </div>

      <!-- 右侧 iframe -->
      <div class="main">
        <iframe id="mainFrame" name="mainFrame" src="./hotsearch.html"></iframe>
      </div>
    </div>

    <script>
      /* 主题初始化 */
      document.body.classList.add(
        (localStorage.getItem("theme") || "light") + "-mode"
      );

      document.addEventListener("DOMContentLoaded", () => {
        const iframe = document.getElementById("mainFrame");
        const navLinks = document.querySelectorAll(".nav-links a[data-src]");
        const footer = document.querySelector(".footer[data-src]");

        /** 高亮处理 */
        function setActive(link) {
          navLinks.forEach((l) => l.classList.toggle("active", l === link));
        }

        /* 侧边栏普通按钮 */
        navLinks.forEach((link) => {
          link.addEventListener("click", (e) => {
            e.preventDefault();
            iframe.src = link.dataset.src;
            setActive(link);
          });
        });

        /* 默认高亮第一个（热搜） */
        setActive(
          document.querySelector('.nav-links a[data-src="./hotsearch.html"]')
        );

        /* footer -> about.html（不参与高亮） */
        footer.addEventListener("click", (e) => {
          e.preventDefault();
          iframe.src = footer.dataset.src;
          setActive(null); // 取消侧栏高亮
        });
      });
      // 在侧栏 JS 里
      const prefetch = (url) => fetch(url).then((r) => r.blob());

      // 初始化时：
      ["hotsearch.html", "settings.html", "about.html"].forEach(prefetch);

      /* —— 同步父页面主题 —— */
      (function () {
        const applyTheme = (theme = "light") => {
          document.body.classList.remove("light-mode", "dark-mode");
          document.body.classList.add(theme + "-mode");

          /* 同步 iframe 的纯色底色，防止下一次卸载时出现反色闪烁 */
          const frame = document.getElementById("mainFrame");
          if (frame)
            frame.style.background = theme === "dark" ? "#1e1e1e" : "#f9fafc";
        };

        /* 首次进来就按 localStorage 绘制 */
        applyTheme(localStorage.getItem("theme"));

        /* 监听其它页面（iframe）改动 localStorage 时触发的 storage 事件 */
        window.addEventListener("storage", (e) => {
          if (e.key === "theme") applyTheme(e.newValue || "light");
        });
      })();
      const btnExit = document.getElementById("btnExit");

      btnExit.addEventListener("click", (e) => {
        e.preventDefault();
        // 可选：二次确认
        // if (confirm("确认退出 ResearchHelper？")) {
        ipcRenderer.send("app-exit"); // 发给主进程
        // }
      });
      const btnPin = document.getElementById("btnPin");

      /* 请求主进程切换置顶；收到状态后再改图标 */
      btnPin.addEventListener("click", (e) => {
        e.preventDefault();
        window.electronAPI.toggleTop();
      });

      /* 主进程返回置顶状态时切换样式 */
      window.electronAPI.onTopState((isTop) => {
        btnPin.classList.toggle("pin-active", isTop); // ← 只改这里
      });

      const applyTheme = (t) => {
        document.documentElement.classList.remove("light-mode", "dark-mode");
        document.body.classList.remove("light-mode", "dark-mode");
        document.documentElement.classList.add(`${t}-mode`);
        document.body.classList.add(`${t}-mode`);
      };
      applyTheme(localStorage.getItem("theme") || "light");
      window.addEventListener("storage", (e) => {
        if (e.key === "theme") applyTheme(e.newValue || "light");
      });
    </script>
  </body>
</html>
